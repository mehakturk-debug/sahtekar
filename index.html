<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SAHTEKAR AKT√úRKLER - 100 TL √ñD√úLL√ú</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #050811; --card: #111827; --accent: #00f2ff; --neon-pink: #ff007f; 
            --red: #ff3838; --green: #00ff88; --orange: #ffb300; --gray: #1f2937; 
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); color: white; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        .container { background: var(--card); width: 100%; height: 100%; display: flex; flex-direction: column; position: relative; border: 1px solid rgba(0, 242, 255, 0.1); }
        @media (min-width: 600px) { .container { width: 420px; height: 95vh; border-radius: 30px; } }
        
        .brand-header { font-family: 'Orbitron', sans-serif; text-align: center; padding: 10px; color: var(--neon-pink); text-shadow: 0 0 10px var(--neon-pink); font-size: 18px; font-weight: 900; }
        
        /* √ñd√ºl Banner */
        .reward-banner { background: linear-gradient(90deg, #ffd700, #ffa500); color: #000; font-weight: 900; text-align: center; padding: 5px; font-size: 12px; animation: flash 1s infinite; }
        @keyframes flash { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }

        .player-bar { display: flex; gap: 10px; padding: 12px; background: rgba(0,0,0,0.4); overflow-x: auto; min-height: 95px; }
        .p-card { background: rgba(255,255,255,0.03); padding: 8px; border-radius: 15px; display: flex; flex-direction: column; align-items: center; min-width: 85px; border: 1px solid rgba(0, 242, 255, 0.1); transition: 0.5s; }
        .p-card.rank-0 { border-color: var(--orange); box-shadow: 0 0 15px rgba(255, 179, 0, 0.2); }
        
        .screen { display: none; flex: 1; flex-direction: column; padding: 20px; text-align: center; overflow-y: auto; }
        .active { display: flex; }

        .rules-box { background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 15px; text-align: left; font-size: 11px; margin-bottom: 15px; border-left: 4px solid var(--neon-pink); }
        
        /* Karakter Se√ßim D√ºzeltmesi */
        .char-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 15px 0; }
        .char-item { 
            background: var(--gray); padding: 15px 5px; border-radius: 12px; font-weight: bold; 
            cursor: pointer; border: 2px solid transparent; transition: 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .char-item.selected { border-color: var(--accent); background: #1e293b; box-shadow: 0 0 15px var(--accent); }

        .sabotage-alert { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--red); color: white; padding: 20px; border-radius: 20px; z-index: 100; font-weight: 900; display: none; animation: shake 0.5s infinite; }
        @keyframes shake { 0% { left: 49%; } 50% { left: 51%; } 100% { left: 50%; } }
        
        .word-display { font-size: 28px; letter-spacing: 5px; margin: 15px 0; color: var(--accent); font-weight: 900; font-family: 'Orbitron'; }
        .keyboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(36px, 1fr)); gap: 6px; }
        .key { background: var(--gray); padding: 12px 0; border-radius: 10px; font-weight: bold; cursor: pointer; border: none; color: white; }
        .key.correct { background: var(--green) !important; }
        .key.wrong { background: var(--red) !important; opacity: 0.3; }
        
        .main-btn { background: linear-gradient(135deg, var(--accent), #1e3a8a); color: white; border: none; padding: 16px; border-radius: 15px; font-weight: 900; cursor: pointer; width: 100%; }
    </style>
</head>
<body>

<div class="container">
    <div class="reward-banner">üí∞ 1000 PUANA ULA≈ûAN ƒ∞LK Kƒ∞≈ûƒ∞YE 100 TL √ñD√úL! üí∞</div>
    <div class="brand-header">SAHTEKAR AKT√úRKLER</div>
    <div id="sabotage" class="sabotage-alert">‚ö†Ô∏è SABOTAJ! KLAVYE KARI≈ûTI! ‚ö†Ô∏è</div>
    <div class="player-bar" id="playerBar"></div>

    <div id="lobbyScreen" class="screen active">
        <div class="rules-box">
            <p style="text-align:center; font-weight:900; font-size:14px; margin-top:0;">üìú ARENA KURALLARI</p>
            ‚Ä¢ <b>√ñD√úL:</b> 1000 puana ula≈üan ilk oyuncu <b>100 TL</b> kazanƒ±r!<br>
            ‚Ä¢ Soru sayƒ±sƒ± biterse veya s√ºre dolarsa en y√ºksek puan kazanƒ±r.<br>
            ‚Ä¢ Lider isen rakiplerin yandƒ±k√ßa klavyen <b>SABOTE</b> edilir.
        </div>

        <div style="margin-bottom: 20px;">
            <p style="font-size: 12px; margin-bottom: 8px;">KARAKTERƒ∞Nƒ∞ SE√á:</p>
            <div class="char-grid">
                <div class="char-item" onclick="selectCharacter(this, 'Mehmet')">Mehmet</div>
                <div class="char-item" onclick="selectCharacter(this, 'Emre')">Emre</div>
                <div class="char-item" onclick="selectCharacter(this, 'Recep')">Recep</div>
                <div class="char-item" onclick="selectCharacter(this, 'Furkan')">Furkan</div>
                <div class="char-item" onclick="selectCharacter(this, 'Ali')">Ali</div>
            </div>
            <button class="main-btn" onclick="enterGame()">ARENAYA Gƒ∞R</button>
        </div>

        <div id="modArea" style="display:none; padding:15px; background: rgba(0,242,255,0.05); border-radius:20px; border:1px dashed var(--accent);">
            <p style="color:var(--orange); font-weight:bold; margin-top:0;">KAPTAN MASASI</p>
            Soru: <input type="number" id="mQ" value="20" style="width:40px; background:var(--gray); color:white; border:none; border-radius:5px;"> 
            S√ºre: <input type="number" id="mT" value="10" style="width:40px; background:var(--gray); color:white; border:none; border-radius:5px;"> dk
            <button class="main-btn" onclick="startMatch()" style="background: var(--green); margin-top:10px;">MA√áI BA≈ûLAT</button>
        </div>
    </div>

    <div id="gameScreen" class="screen">
        <div style="display:flex; justify-content:space-between; font-size:12px;">
            <span id="timer" style="color:var(--orange)">00:00</span>
            <span id="progress">SORU: 1/10</span>
        </div>
        <div id="category" style="color:var(--neon-pink); font-weight:900; margin-top:10px; font-size: 14px;">KATEGORƒ∞</div>
        <div class="word-display" id="wordBox">_ _ _ _</div>
        <div id="keyboard" class="keyboard"></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, update, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBcm1uY37IelMsTqoD0sAmsIH1nwBeYtCE",
        authDomain: "sahtekar-2f5d2.firebaseapp.com",
        databaseURL: "https://sahtekar-2f5d2-default-rtdb.europe-west1.firebasedatabase.app/",
        projectId: "sahtekar-2f5d2",
        appId: "1:223883537002:web:1c16bde374d11efb5d7813"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const ROOM = "AKT_FINAL_REWARD_V1";

    let me = { name: "", score: 0, currentQ: 1, mistakes: 0, guesses: [], locked: false };
    
    // 1000 Soru Altyapƒ±sƒ±
    const allWords = [
        {w:"ALGORƒ∞TMA", c:"Yazƒ±lƒ±m"}, {w:"VERƒ∞TABANI", c:"Yazƒ±lƒ±m"}, {w:"PENGUEN", c:"Hayvan"},
        {w:"ƒ∞STANBUL", c:"≈ûehir"}, {w:"GELƒ∞BOLU", c:"≈ûehir"}, {w:"Bƒ∞LGƒ∞SAYAR", c:"Cihaz"}
        // ... Diƒüer kelimeler buraya
    ];

    // Karakter Se√ßim D√ºzeltmesi (Tƒ±klama Garantili)
    window.selectCharacter = (el, name) => {
        me.name = name;
        document.querySelectorAll('.char-item').forEach(i => i.classList.remove('selected'));
        el.classList.add('selected');
        if(navigator.vibrate) navigator.vibrate(50);
    };

    window.enterGame = async () => {
        if(!me.name) return alert("√ñnce karakterini se√ß!");
        const rRef = ref(db, `games/${ROOM}`);
        const snap = await get(rRef);
        if(!snap.exists()) await set(rRef, { status:'LOBBY', mod: me.name, config: {q:20, e:5, t:10}, players:{} });
        await update(ref(db, `games/${ROOM}/players/${me.name}`), { name: me.name, score: 0, currentQ: 1 });
        
        onValue(rRef, (s) => {
            const d = s.val(); if(!d) return;
            if(d.mod === me.name) document.getElementById('modArea').style.display = 'block';
            
            if(d.status === 'LIVE') {
                const elapsed = Math.floor((Date.now() - d.start) / 1000);
                const rem = (d.config.t * 60) - elapsed;
                if(rem <= 0) { alert("S√ºre bitti!"); location.reload(); return; }

                document.getElementById('lobbyScreen').classList.remove('active');
                document.getElementById('gameScreen').classList.add('active');
                
                const p = d.players[me.name];
                if(p.score >= 1000) { alert("TEBRƒ∞KLER! " + p.name + " 1000 PUANA ULA≈ûTI VE KAZANDI!"); location.reload(); }

                if(p.currentQ !== me.currentQ) { me.currentQ = p.currentQ; me.guesses = []; me.mistakes = 0; }
                render(d, rem);
            }
            updateBar(d.players);
        });
    };

    window.startMatch = () => update(ref(db, `games/${ROOM}`), { 
        status:'LIVE', start:Date.now(), config: { q: parseInt(document.getElementById('mQ').value), e: 5, t: parseInt(document.getElementById('mT').value) } 
    });

    function render(data, rem) {
        const sorted = Object.values(data.players).sort((a,b) => b.score - a.score);
        const isLeader = sorted[0].name === me.name;
        let alf = "ABC√áDEFGƒûHIƒ∞JKLMNO√ñPRS≈ûTU√úVYZ".split("");
        
        if(isLeader && data.lastMistakeUser && data.lastMistakeUser !== me.name) {
            alf = alf.sort(() => Math.random() - 0.5);
            document.getElementById('sabotage').style.display = 'block';
            setTimeout(() => document.getElementById('sabotage').style.display = 'none', 1000);
        }

        const cur = allWords[(me.currentQ - 1) % allWords.length];
        const m = Math.floor(rem/60), s = rem%60;
        document.getElementById('timer').innerText = `${m}:${s<10?'0':''}${s}`;
        document.getElementById('progress').innerText = `SORU: ${me.currentQ}/${data.config.q}`;
        document.getElementById('category').innerText = "KATEGORƒ∞: " + cur.c.toUpperCase();
        
        let d = "";
        cur.w.split('').forEach(l => d += me.guesses.includes(l) ? l + " " : "_ ");
        document.getElementById('wordBox').innerText = d;

        const kb = document.getElementById('keyboard'); kb.innerHTML = "";
        alf.forEach(l => {
            const b = document.createElement('button');
            b.className = 'key' + (me.guesses.includes(l) ? (cur.w.includes(l) ? ' correct' : ' wrong') : '');
            b.innerText = l;
            b.onclick = () => press(l, cur.w, data.config.q);
            kb.appendChild(b);
        });

        if(d.replace(/ /g, '') === cur.w && !me.locked) {
            me.locked = true; setTimeout(() => next(true, data.config.q), 800);
        }
    }

    function press(l, w, maxQ) {
        if(me.guesses.includes(l) || me.locked) return;
        me.guesses.push(l);
        if(!w.includes(l)) {
            me.mistakes++;
            update(ref(db, `games/${ROOM}`), { lastMistakeUser: me.name, t: Date.now() });
            if(me.mistakes >= 5) next(false, maxQ);
        } else {
            me.score += 10;
        }
        update(ref(db, `games/${ROOM}/players/${me.name}`), { score: me.score, currentQ: me.currentQ });
    }

    function next(win, maxQ) {
        if(win) me.score += 50;
        me.currentQ++; me.guesses = []; me.mistakes = 0; me.locked = false;
        update(ref(db, `games/${ROOM}/players/${me.name}`), { score: me.score, currentQ: me.currentQ });
    }

    function updateBar(players) {
        const sorted = Object.values(players).sort((a,b) => b.score - a.score);
        document.getElementById('playerBar').innerHTML = sorted.map((p, i) => `
            <div class="p-card rank-${i}">
                <span style="font-size:10px; font-weight:bold;">${p.name}</span>
                <span style="color:var(--accent); font-size:12px;">${p.score}</span>
            </div>`).join('');
    }
</script>
</body>
</html>
