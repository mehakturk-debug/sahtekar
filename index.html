<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adam Asmaca - Pro Multiplayer</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; --red: #ef4444; --green: #22c55e; --orange: #f59e0b; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: white; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { background: var(--card); border-radius: 24px; padding: 20px; width: 95%; max-width: 600px; box-shadow: 0 25px 50px rgba(0,0,0,0.5); position: relative; }
        .screen { display: none; transition: 0.3s; }
        .active { display: block; }
        
        /* Giri≈ü Ekranƒ± */
        .player-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0; }
        .player-opt { background: #334155; padding: 15px; border-radius: 12px; text-align: center; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .player-opt.selected { border-color: var(--accent); background: #1e293b; transform: scale(1.05); }
        
        input { width: 100%; padding: 12px; box-sizing: border-box; background: #334155; border: 1px solid #475569; color: white; border-radius: 12px; margin-bottom: 10px; }
        button { width: 100%; padding: 14px; background: var(--accent); color: #0f172a; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 16px; }

        /* Oyun Ekranƒ± */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #475569; padding-bottom: 10px; }
        .word-box { font-size: 36px; text-align: center; letter-spacing: 8px; margin: 30px 0; font-family: 'Courier New', monospace; color: var(--accent); min-height: 50px; }
        .hangman-stage { text-align: center; font-size: 18px; color: var(--red); font-weight: bold; margin-bottom: 10px; }
        
        .keyboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(35px, 1fr)); gap: 6px; }
        .key { background: #334155; padding: 10px 5px; border-radius: 8px; text-align: center; cursor: pointer; user-select: none; border-bottom: 3px solid #1e293b; }
        .key.used { opacity: 0.2; pointer-events: none; }
        
        .score-list { margin-top: 20px; background: rgba(0,0,0,0.2); border-radius: 15px; padding: 10px; }
        .score-item { display: flex; justify-content: space-between; padding: 5px 10px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .score-item:last-child { border: none; }
        .current-turn-label { color: var(--orange); font-weight: bold; text-align: center; display: block; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginScreen" class="screen active">
        <h1 style="text-align:center;">üé≠ Karakter Se√ß</h1>
        <div class="player-grid">
            <div class="player-opt" data-name="Mehmet">Mehmet</div>
            <div class="player-opt" data-name="Emre">Emre</div>
            <div class="player-opt" data-name="Recep">Recep</div>
            <div class="player-opt" data-name="Furkan">Furkan</div>
            <div class="player-opt" data-name="Ali">Ali</div>
        </div>
        <input type="text" id="roomCode" placeholder="Oyun Kodu (√ñrn: 1453)" value="1453">
        <button id="joinBtn">BAƒûLAN VE BA≈ûLA</button>
    </div>

    <div id="gameScreen" class="screen">
        <div class="header">
            <div id="myStatus"></div>
            <div id="gameTimer" style="color:var(--orange)">‚è≥ 60s</div>
        </div>

        <span class="current-turn-label" id="turnInfo">Sƒ±ra Bekleniyor...</span>
        
        
        <div class="hangman-stage" id="mistakeInfo">Hata: 0/6</div>
        <div class="word-box" id="wordDisplay">_ _ _ _</div>

        <div id="wordInputArea" style="display:none">
            <input type="text" id="targetWord" placeholder="Bir kelime belirle..." maxlength="12">
            <button onclick="sendWord()">KELƒ∞MEYƒ∞ YAYINLA</button>
        </div>

        <div id="guessArea" style="display:none">
            <div class="keyboard" id="keyboard"></div>
        </div>

        <div class="score-list" id="scoreBoard"></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, update, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBcm1uY37IelMsTqoD0sAmsIH1nwBeYtCE",
        authDomain: "sahtekar-2f5d2.firebaseapp.com",
        databaseURL: "https://sahtekar-2f5d2-default-rtdb.europe-west1.firebasedatabase.app/",
        projectId: "sahtekar-2f5d2",
        appId: "1:223883537002:web:1c16bde374d11efb5d7813"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let myName = "", roomID = "", timerVal = 60, timerInt;

    const alfabe = "ABC√áDEFGƒûHIƒ∞JKLMNO√ñPRS≈ûTU√úVYZ".split("");

    // Karakter Se√ßimi
    document.querySelectorAll('.player-opt').forEach(div => {
        div.onclick = () => {
            document.querySelectorAll('.player-opt').forEach(d => d.classList.remove('selected'));
            div.classList.add('selected');
            myName = div.dataset.name;
        };
    });

    // Giri≈ü Yap
    document.getElementById('joinBtn').onclick = async () => {
        if(!myName) return alert("L√ºtfen ismini se√ß!");
        roomID = document.getElementById('roomCode').value.trim() || "1453";
        
        const node = ref(db, `games/${roomID}`);
        const snap = await get(node);
        
        if(!snap.exists()) {
            await set(node, {
                status: 'WAITING',
                turnIdx: 0,
                players: ["Mehmet", "Emre", "Recep", "Furkan", "Ali"],
                scores: { Mehmet:0, Emre:0, Recep:0, Furkan:0, Ali:0 },
                word: "",
                guesses: "",
                mistakes: 0
            });
        }
        
        document.getElementById('loginScreen').classList.remove('active');
        document.getElementById('gameScreen').classList.add('active');
        document.getElementById('myStatus').innerText = "üë§ " + myName;
        syncGame();
    };

    function syncGame() {
        onValue(ref(db, `games/${roomID}`), (s) => {
            const d = s.val(); if(!d) return;

            const turnOwner = d.players[d.turnIdx];
            document.getElementById('turnInfo').innerText = `Sƒ±radaki: ${turnOwner}`;
            document.getElementById('mistakeInfo').innerText = `Hata: ${d.mistakes}/6`;
            
            // Skor Tablosu
            document.getElementById('scoreBoard').innerHTML = d.players
                .map(p => `<div class="score-item"><span>${p}</span><b>${d.scores[p]} Puan</b></div>`).join('');

            // Oyun Mantƒ±ƒüƒ±
            if(d.status === 'WAITING') {
                document.getElementById('wordDisplay').innerText = "BEKLENƒ∞YOR";
                if(myName === turnOwner) {
                    document.getElementById('wordInputArea').style.display = 'block';
                    document.getElementById('guessArea').style.display = 'none';
                } else {
                    document.getElementById('wordInputArea').style.display = 'none';
                    document.getElementById('guessArea').style.display = 'none';
                }
            } else if(d.status === 'PLAYING') {
                document.getElementById('wordInputArea').style.display = 'none';
                const isWinner = updateDisplay(d.word, d.guesses);
                
                if(myName === turnOwner) {
                    document.getElementById('guessArea').style.display = 'none';
                    document.getElementById('wordDisplay').innerText = d.word; // Yazan ki≈üi kelimeyi g√∂r√ºr
                } else {
                    document.getElementById('guessArea').style.display = 'block';
                    drawKeyboard(d.guesses);
                }
                
                if(isWinner || d.mistakes >= 6) finalizeRound(isWinner, d);
            }
        });
    }

    function updateDisplay(word, guesses) {
        let res = "";
        let found = 0;
        word.split('').forEach(l => {
            if(guesses.includes(l)) { res += l + " "; found++; }
            else { res += "_ "; }
        });
        document.getElementById('wordDisplay').innerText = res;
        return found === word.length;
    }

    function drawKeyboard(guesses) {
        const cont = document.getElementById('keyboard');
        cont.innerHTML = "";
        alfabe.forEach(harf => {
            const k = document.createElement('div');
            k.className = `key ${guesses.includes(harf) ? 'used' : ''}`;
            k.innerText = harf;
            k.onclick = () => handleGuess(harf);
            cont.appendChild(k);
        });
    }

    window.sendWord = () => {
        const w = document.getElementById('targetWord').value.toUpperCase().trim();
        if(w.length < 3) return alert("En az 3 harf!");
        update(ref(db, `games/${roomID}`), { word: w, status: 'PLAYING', guesses: "", mistakes: 0 });
        document.getElementById('targetWord').value = "";
    };

    async function handleGuess(char) {
        const s = await get(ref(db, `games/${roomID}`));
        const d = s.val();
        if(d.guesses.includes(char)) return;

        let upd = { guesses: d.guesses + char };
        if(!d.word.includes(char)) upd.mistakes = d.mistakes + 1;
        update(ref(db, `games/${roomID}`), upd);
    }

    function finalizeRound(win, data) {
        let newScores = {...data.scores};
        if(win) {
            // Kelimeyi bilen gruba puan ver (Yazan hari√ß)
            data.players.forEach(p => {
                if(p !== data.players[data.turnIdx]) newScores[p] += 10;
            });
        }
        
        const next = (data.turnIdx + 1) % data.players.length;
        
        // 3 saniye sonra yeni tura ge√ß
        setTimeout(() => {
            update(ref(db, `games/${roomID}`), {
                status: 'WAITING',
                turnIdx: next,
                scores: newScores,
                word: "",
                guesses: ""
            });
        }, 3000);
    }
</script>
</body>
</html>
