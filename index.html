<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adam Asmaca - Multiplayer</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; --red: #ef4444; --green: #22c55e; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { background: var(--card); border-radius: 24px; padding: 20px; width: 95%; max-width: 800px; min-height: 80vh; position: relative; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .screen { display: none; }
        .active { display: block; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; background: #334155; border: 1px solid #475569; color: white; border-radius: 12px; }
        button { width: 100%; padding: 14px; background: var(--accent); color: #0f172a; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        
        /* Karakter SeÃ§imi */
        .player-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0; }
        .player-opt { background: #334155; padding: 10px; border-radius: 12px; text-align: center; cursor: pointer; border: 2px solid transparent; }
        .player-opt.selected { border-color: var(--accent); background: #1e293b; }
        .avatar-pre { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-bottom: 5px; background: #475569; }

        /* Oyun AlanÄ± */
        .word-display { font-size: 32px; text-align: center; letter-spacing: 10px; margin: 20px 0; font-family: monospace; color: var(--accent); }
        .keyboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(40px, 1fr)); gap: 5px; margin-top: 20px; }
        .key { background: #334155; padding: 10px; border-radius: 5px; text-align: center; cursor: pointer; border: 1px solid #475569; }
        .key.used { opacity: 0.3; pointer-events: none; }
        
        .status-bar { display: flex; justify-content: space-between; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 10px; margin-bottom: 15px; font-size: 14px; }
        .hangman-drawing { text-align: center; font-size: 14px; color: var(--red); font-family: monospace; white-space: pre; margin: 10px 0; }
        #timer { font-weight: bold; color: #f59e0b; }
        
        .side-player { display: flex; align-items: center; gap: 10px; padding: 8px; background: #334155; border-radius: 10px; margin-bottom: 5px; }
        .score-badge { margin-left: auto; background: var(--accent); color: #0f172a; padding: 2px 8px; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div id="homeScreen" class="screen active">
        <h1 style="text-align:center; color:var(--accent)">ðŸŽ­ Adam Asmaca Pro</h1>
        <div class="player-grid">
            <div class="player-opt" data-name="Mehmet"><span>Mehmet</span></div>
            <div class="player-opt" data-name="Emre"><span>Emre</span></div>
            <div class="player-opt" data-name="Recep"><span>Recep</span></div>
            <div class="player-opt" data-name="Furkan"><span>Furkan</span></div>
            <div class="player-opt" data-name="Ali"><span>Ali</span></div>
        </div>
        <input type="text" id="roomCode" placeholder="Oyun Kodu (Ã–rn: 1234)" value="1234">
        <button id="btnEnter">OYUNA KATIL</button>
    </div>

    <div id="gameScreen" class="screen">
        <div class="status-bar">
            <div>SÄ±ra: <b id="turnName">...</b></div>
            <div id="timer">SÃ¼re: 60</div>
        </div>

        <div id="sideList" style="margin-bottom: 15px;"></div>

        <div class="hangman-drawing" id="hangmanArt">
          Hata: 0/6
        </div>

        <div id="wordDisplay" class="word-display">_ _ _ _</div>

        <div id="inputArea" style="display:none">
            <input type="text" id="secretWord" placeholder="Kelimeyi YazÄ±n" maxlength="15">
            <button onclick="submitWord()">KELÄ°MEYÄ° GÃ–NDER</button>
        </div>

        <div id="guessArea" style="display:none">
            <div class="keyboard" id="keyboard"></div>
        </div>
    </div>
</div>



<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, update, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBcm1uY37IelMsTqoD0sAmsIH1nwBeYtCE",
        authDomain: "sahtekar-2f5d2.firebaseapp.com",
        databaseURL: "https://sahtekar-2f5d2-default-rtdb.europe-west1.firebasedatabase.app/",
        projectId: "sahtekar-2f5d2",
        appId: "1:223883537002:web:1c16bde374d11efb5d7813"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let myName = "", gameCode = "", timerInterval;

    const alphabet = "ABCÃ‡DEFGÄžHIÄ°JKLMNOÃ–PRSÅžTUÃœVYZ".split("");

    // --- SEÃ‡Ä°M MANTIÄžI ---
    document.querySelectorAll('.player-opt').forEach(opt => {
        opt.onclick = () => {
            document.querySelectorAll('.player-opt').forEach(e => e.classList.remove('selected'));
            opt.classList.add('selected');
            myName = opt.dataset.name;
        };
    });

    document.getElementById('btnEnter').onclick = async () => {
        if(!myName) return alert("LÃ¼tfen karakter seÃ§!");
        gameCode = document.getElementById('roomCode').value.trim().toUpperCase() || "1234";
        
        const snap = await get(ref(db, `games/${gameCode}`));
        if(!snap.exists()) {
            await set(ref(db, `games/${gameCode}`), {
                status: 'WAITING_FOR_WORD',
                turnIndex: 0,
                players: ["Mehmet", "Emre", "Recep", "Furkan", "Ali"],
                scores: { Mehmet:0, Emre:0, Recep:0, Furkan:0, Ali:0 },
                currentWord: "",
                guessedLetters: "",
                mistakes: 0,
                lastUpdate: Date.now()
            });
        }
        
        document.getElementById('homeScreen').classList.remove('active');
        document.getElementById('gameScreen').classList.add('active');
        startListening();
    };

    function startListening() {
        onValue(ref(db, `games/${gameCode}`), (snapshot) => {
            const data = snapshot.val();
            if(!data) return;

            const turnOwner = data.players[data.turnIndex];
            document.getElementById('turnName').innerText = turnOwner;
            
            // Skor Tablosu
            document.getElementById('sideList').innerHTML = data.players.map(p => `
                <div class="side-player">
                    <span>${p}</span>
                    <span class="score-badge">${data.scores[p] || 0}</span>
                </div>
            `).join('');

            // Adam Asmaca Ã‡izim/Hata Durumu
            document.getElementById('hangmanArt').innerText = `Hata: ${data.mistakes}/6`;

            // Oyun Durumu YÃ¶netimi
            if(data.status === 'WAITING_FOR_WORD') {
                document.getElementById('wordDisplay').innerText = "KELÄ°ME BEKLENÄ°YOR";
                if(myName === turnOwner) {
                    document.getElementById('inputArea').style.display = 'block';
                    document.getElementById('guessArea').style.display = 'none';
                } else {
                    document.getElementById('inputArea').style.display = 'none';
                    document.getElementById('guessArea').style.display = 'none';
                }
            } 
            else if(data.status === 'GUESSING') {
                document.getElementById('inputArea').style.display = 'none';
                renderWord(data.currentWord, data.guessedLetters);
                
                if(myName === turnOwner) {
                    document.getElementById('guessArea').style.display = 'none';
                    document.getElementById('wordDisplay').innerText = data.currentWord + " (Sen YazdÄ±n)";
                } else {
                    document.getElementById('guessArea').style.display = 'block';
                    renderKeyboard(data.guessedLetters);
                }
            }

            // Kazanma/Kaybetme KontrolÃ¼
            checkGameEnd(data);
        });
    }

    function renderWord(word, guessed) {
        let display = "";
        let winCount = 0;
        word.split("").forEach(letter => {
            if(guessed.includes(letter)) {
                display += letter + " ";
                winCount++;
            } else {
                display += "_ ";
            }
        });
        document.getElementById('wordDisplay').innerText = display;
        return winCount === word.length;
    }

    function renderKeyboard(guessed) {
        const kb = document.getElementById('keyboard');
        kb.innerHTML = "";
        alphabet.forEach(l => {
            const btn = document.createElement('div');
            btn.className = `key ${guessed.includes(l) ? 'used' : ''}`;
            btn.innerText = l;
            btn.onclick = () => makeGuess(l);
            kb.appendChild(btn);
        });
    }

    window.submitWord = () => {
        const word = document.getElementById('secretWord').value.toUpperCase().trim();
        if(word.length < 2) return alert("Ã‡ok kÄ±sa!");
        update(ref(db, `games/${gameCode}`), {
            currentWord: word,
            status: 'GUESSING',
            guessedLetters: "",
            mistakes: 0
        });
        document.getElementById('secretWord').value = "";
    };

    async function makeGuess(letter) {
        const s = await get(ref(db, `games/${gameCode}`));
        const d = s.val();
        let newGuessed = d.guessedLetters + letter;
        let newMistakes = d.mistakes;

        if(!d.currentWord.includes(letter)) {
            newMistakes++;
        }

        update(ref(db, `games/${gameCode}`), {
            guessedLetters: newGuessed,
            mistakes: newMistakes
        });
    }

    async function checkGameEnd(data) {
        if(data.status !== 'GUESSING') return;

        const isWin = data.currentWord.split("").every(l => data.guessedLetters.includes(l));
        const isLose = data.mistakes >= 6;

        if(isWin || isLose) {
            let updates = {};
            const nextIdx = (data.turnIndex + 1) % data.players.length;
            
            if(isWin) {
                // Tahmin edenlere (sÄ±rasÄ± olmayanlara) puan ver
                data.players.forEach(p => {
                    if(p !== data.players[data.turnIndex]) {
                        updates[`scores/${p}`] = (data.scores[p] || 0) + 10;
                    }
                });
                alert("Kelime Bildi!");
            } else {
                alert("Adam AsÄ±ldÄ±! Kelime: " + data.currentWord);
            }

            updates['status'] = 'WAITING_FOR_WORD';
            updates['turnIndex'] = nextIdx;
            updates['currentWord'] = "";
            
            // YarÄ±m saniye gecikme ile sÄ±fÄ±rla ki sonucu gÃ¶rsÃ¼nler
            setTimeout(() => update(ref(db, `games/${gameCode}`), updates), 2000);
        }
    }
</script>
</body>
</html>
